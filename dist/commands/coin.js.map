{"version":3,"sources":["../../src/commands/coin.ts"],"sourcesContent":["import {\n    AutocompleteInteraction,\n    chatInputApplicationCommandMention,\n    ChatInputCommandInteraction,\n    SlashCommandBuilder\n} from \"discord.js\";\nimport {db} from \"../database.js\";\nimport didyoumean from \"didyoumean\";\nimport {CryptoApiData} from \"../structs/cryptoapidata.js\";\nimport {cryptoNameList, cryptoSymbolList} from \"../utils.js\";\nimport {makeButtons, makeEmbed, makeFavouritesMenu} from \"../ui/coin/interfaceCreator.js\";\n\nexport default {\n    data: new SlashCommandBuilder()\n        .setName(\"coin\")\n        .setDescription(\"Gets information about a cryptocurrency\")\n        .addStringOption(option =>\n            option.setName(\"name\").setDescription(\"The name/symbol of the coin\").setAutocomplete(true)\n        ),\n    async execute(interaction: ChatInputCommandInteraction) {\n\n        let input = interaction.options.getString(\"name\");\n        if (!input) {\n            input = \"btc\";\n        }\n\n        const choice: CryptoApiData = await db.get(\"select * from cmc_cache where symbol=? collate nocase or name=? collate nocase\", input);\n        if (!choice) {\n            const suggestion = didyoumean(input.toLowerCase(), cryptoSymbolList.concat(cryptoNameList));\n            await interaction.reply(\n                `Couldn't find a coin called \\`${input}\\`. ${suggestion != null\n                    ? `Did you mean ${chatInputApplicationCommandMention(\n                        interaction.commandName,\n                        interaction.commandId\n                    )} \\`${suggestion}\\`?`\n                    : \"\"\n                }`\n            );\n            return;\n        }\n\n        const embed = await makeEmbed(choice, interaction.client);\n        const buttons = await makeButtons(choice, interaction);\n        const favourites = await makeFavouritesMenu(interaction);\n        await interaction.reply({embeds: [embed], components: [buttons, favourites], fetchReply: true});\n    },\n    async autocomplete(interaction: AutocompleteInteraction) {\n        const focusedValue = interaction.options.getFocused().toLowerCase();\n        const filtered = cryptoSymbolList.filter(choice => choice.toLowerCase().startsWith(focusedValue));\n        filtered.length = Math.min(filtered.length, 25);\n        await interaction.respond(filtered.map(choice => ({name: choice, value: choice})));\n    }\n\n};\n"],"names":["chatInputApplicationCommandMention","SlashCommandBuilder","db","didyoumean","cryptoNameList","cryptoSymbolList","makeButtons","makeEmbed","makeFavouritesMenu","data","setName","setDescription","addStringOption","option","setAutocomplete","execute","interaction","input","options","getString","choice","get","suggestion","toLowerCase","concat","reply","commandName","commandId","embed","client","buttons","favourites","embeds","components","fetchReply","autocomplete","focusedValue","getFocused","filtered","filter","startsWith","length","Math","min","respond","map","name","value"],"mappings":"AAAA,SAEIA,kCAAkC,EAElCC,mBAAmB,QAChB,aAAa;AACpB,SAAQC,EAAE,QAAO,iBAAiB;AAClC,OAAOC,gBAAgB,aAAa;AAEpC,SAAQC,cAAc,EAAEC,gBAAgB,QAAO,cAAc;AAC7D,SAAQC,WAAW,EAAEC,SAAS,EAAEC,kBAAkB,QAAO,iCAAiC;AAE1F,eAAe;IACXC,MAAM,IAAIR,sBACLS,OAAO,CAAC,QACRC,cAAc,CAAC,2CACfC,eAAe,CAACC,CAAAA,SACbA,OAAOH,OAAO,CAAC,QAAQC,cAAc,CAAC,+BAA+BG,eAAe,CAAC,IAAI;IAEjG,MAAMC,SAAQC,WAAwC,EAAE;QAEpD,IAAIC,QAAQD,YAAYE,OAAO,CAACC,SAAS,CAAC;QAC1C,IAAI,CAACF,OAAO;YACRA,QAAQ;QACZ,CAAC;QAED,MAAMG,SAAwB,MAAMlB,GAAGmB,GAAG,CAAC,kFAAkFJ;QAC7H,IAAI,CAACG,QAAQ;YACT,MAAME,aAAanB,WAAWc,MAAMM,WAAW,IAAIlB,iBAAiBmB,MAAM,CAACpB;YAC3E,MAAMY,YAAYS,KAAK,CACnB,CAAC,8BAA8B,EAAER,MAAM,IAAI,EAAEK,cAAc,IAAI,GACzD,CAAC,aAAa,EAAEtB,mCACdgB,YAAYU,WAAW,EACvBV,YAAYW,SAAS,EACvB,GAAG,EAAEL,WAAW,GAAG,CAAC,GACpB,EAAE,CACP,CAAC;YAEN;QACJ,CAAC;QAED,MAAMM,QAAQ,MAAMrB,UAAUa,QAAQJ,YAAYa,MAAM;QACxD,MAAMC,UAAU,MAAMxB,YAAYc,QAAQJ;QAC1C,MAAMe,aAAa,MAAMvB,mBAAmBQ;QAC5C,MAAMA,YAAYS,KAAK,CAAC;YAACO,QAAQ;gBAACJ;aAAM;YAAEK,YAAY;gBAACH;gBAASC;aAAW;YAAEG,YAAY,IAAI;QAAA;IACjG;IACA,MAAMC,cAAanB,WAAoC,EAAE;QACrD,MAAMoB,eAAepB,YAAYE,OAAO,CAACmB,UAAU,GAAGd,WAAW;QACjE,MAAMe,WAAWjC,iBAAiBkC,MAAM,CAACnB,CAAAA,SAAUA,OAAOG,WAAW,GAAGiB,UAAU,CAACJ;QACnFE,SAASG,MAAM,GAAGC,KAAKC,GAAG,CAACL,SAASG,MAAM,EAAE;QAC5C,MAAMzB,YAAY4B,OAAO,CAACN,SAASO,GAAG,CAACzB,CAAAA,SAAW,CAAA;gBAAC0B,MAAM1B;gBAAQ2B,OAAO3B;YAAM,CAAA;IAClF;AAEJ,EAAE"}