{"version":3,"sources":["../../src/commands/coin.ts"],"sourcesContent":["import {\n    chatInputApplicationCommandMention,\n    SlashCommandBuilder,\n    ChatInputCommandInteraction,\n    AutocompleteInteraction,\n    ActionRowBuilder,\n    ButtonBuilder,\n    ButtonStyle,\n    ComponentType,\n    StringSelectMenuBuilder\n} from \"discord.js\";\nimport { db } from \"../database.js\";\nimport didyoumean from \"didyoumean\";\nimport { CryptoApiData } from \"../structs/cryptoapidata.js\";\nimport { genCoinEmbed, genFavouritesMenu } from \"../ui/coin/createInterfaces.js\";\nimport { processButtons } from \"../ui/coin/processInteractions.js\";\nimport { editComponents } from \"../ui/editComponents.js\";\nimport { cryptoNameList, cryptoSymbolList } from \"../globals.js\";\n\nexport default {\n    data: new SlashCommandBuilder()\n        .setName(\"coin\")\n        .setDescription(\"Gets information about a cryptocurrency\")\n        .addStringOption(option =>\n            option.setName(\"name\").setDescription(\"The name/symbol of the coin\").setAutocomplete(true)\n        ),\n    async execute(interaction: ChatInputCommandInteraction) {\n\n        const input = interaction.options.getString(\"name\");\n        if (!input) {\n            interaction.reply(\"Please specify a coin to lookup.\");\n            return;\n        }\n\n        let choice: CryptoApiData = await db.get(\"select * from cmc_cache where symbol=? collate nocase or name=? collate nocase\", input);\n        if (!choice) {\n            const suggestion = didyoumean(input.toLowerCase(), cryptoSymbolList.concat(cryptoNameList));\n            interaction.reply(\n                `Couldn't find a coin called \\`${input}\\`. ${suggestion != null\n                    ? `Did you mean ${chatInputApplicationCommandMention(\n                        interaction.commandName,\n                        interaction.commandId\n                    )} \\`${suggestion}\\`?`\n                    : \"\"\n                }`\n            );\n            return;\n        }\n\n        let embed = genCoinEmbed(choice, interaction.client);\n        const favourited = Object.values(await db.get(\"select exists(select 1 from user_settings where id=? and favouriteCrypto=?)\", interaction.user.id, choice.id))[0];\n        const buttons = new ActionRowBuilder<ButtonBuilder>()\n            .addComponents(\n                new ButtonBuilder()\n                    .setCustomId(\"alerts\")\n                    .setLabel(\"Add Alert\")\n                    .setEmoji(\"üîî\")\n                    .setStyle(ButtonStyle.Primary)\n            )\n            .addComponents(\n                new ButtonBuilder()\n                    .setCustomId(\"setfav\")\n                    .setLabel(favourited ? \"Unfavourite\" : \"Favourite\")\n                    .setEmoji(\"‚≠ê\")\n                    .setStyle(favourited ? ButtonStyle.Secondary : ButtonStyle.Primary)\n            );\n\n        const favourites = new ActionRowBuilder<StringSelectMenuBuilder>().addComponents(await genFavouritesMenu(interaction));\n        const response = await interaction.reply({ embeds: [embed], components: [buttons, favourites], fetchReply: true });\n        const favouriteCollector = response.createMessageComponentCollector({ componentType: ComponentType.StringSelect, time: 60000 });\n        favouriteCollector.on(\"collect\", async i => {\n            const selected = i.values[0];\n            if (selected == \"default\") {\n                i.reply({ content: \"Favourite a coin to add it to the list!\", ephemeral: true });\n                return;\n            }\n            choice = (await db.get(\"select * from cmc_cache where id=?\", selected)) as CryptoApiData;\n            embed = genCoinEmbed(choice, i.client);\n            await i.update({ components: i.message.components, embeds: [embed] });\n        });\n        const buttonCollector = response.createMessageComponentCollector({ componentType: ComponentType.Button, time: 60000 });\n        buttonCollector.on(\"collect\", i => {\n            processButtons(i, choice);\n        });\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        buttonCollector.on(\"end\", async _collected => {\n            const disabledComponents = await editComponents(response, async (builder) => {\n                return builder.setDisabled(true);\n            });\n            interaction.editReply({\n                content: \"This message is no longer receiving input.\", embeds: [embed], components: [...disabledComponents]\n            });\n        });\n    },\n    async autocomplete(interaction: AutocompleteInteraction) {\n        const focusedValue = interaction.options.getFocused().toLowerCase();\n        let i = 0;\n        const filtered = cryptoSymbolList.filter(choice => {\n            if (i < 25 && choice.toLowerCase().startsWith(focusedValue)) {\n                i++;\n                return true;\n            }\n            return false;\n        });\n        await interaction.respond(filtered.map(choice => ({ name: choice, value: choice })));\n    }\n\n};\n"],"names":["chatInputApplicationCommandMention","SlashCommandBuilder","ActionRowBuilder","ButtonBuilder","ButtonStyle","ComponentType","db","didyoumean","genCoinEmbed","genFavouritesMenu","processButtons","editComponents","cryptoNameList","cryptoSymbolList","data","setName","setDescription","addStringOption","option","setAutocomplete","execute","interaction","input","options","getString","reply","choice","get","suggestion","toLowerCase","concat","commandName","commandId","embed","client","favourited","Object","values","user","id","buttons","addComponents","setCustomId","setLabel","setEmoji","setStyle","Primary","Secondary","favourites","response","embeds","components","fetchReply","favouriteCollector","createMessageComponentCollector","componentType","StringSelect","time","on","i","selected","content","ephemeral","update","message","buttonCollector","Button","_collected","disabledComponents","builder","setDisabled","editReply","autocomplete","focusedValue","getFocused","filtered","filter","startsWith","respond","map","name","value"],"mappings":"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"}