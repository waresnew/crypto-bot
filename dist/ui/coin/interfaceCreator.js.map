{"version":3,"sources":["../../../src/ui/coin/interfaceCreator.ts"],"sourcesContent":["import {\n    ActionRowBuilder,\n    BaseInteraction,\n    ButtonBuilder,\n    ButtonStyle,\n    Client,\n    StringSelectMenuBuilder\n} from \"discord.js\";\nimport {db} from \"../../database.js\";\nimport {CryptoApiData} from \"../../structs/cryptoapidata.js\";\nimport {UserSettingType} from \"../../structs/usersettings.js\";\nimport {getEmbedTemplate} from \"../templates.js\";\nimport {scientificNotationToNumber} from \"../../utils.js\";\n\nexport async function makeFavouritesMenu(interaction: BaseInteraction) {\n    const selectFavs = new StringSelectMenuBuilder()\n        .setCustomId(`coin_favCoins_${interaction.user.id}`)\n        .setPlaceholder(\"Quickly access your favourites...\");\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const favs = await db.all(\"select favouriteCrypto from user_settings where type=? and id=?\", UserSettingType[UserSettingType.FAVOURITE_CRYPTO], interaction.user.id);\n\n    for (let i = 0; i < favs.length; i++) {\n        const row = favs[i];\n        const favName = await db.get(\"select name from cmc_cache where id=?\", row.favouriteCrypto);\n        if (favName) {\n            selectFavs.addOptions({label: favName.name, value: row.favouriteCrypto.toString()});\n        }\n    }\n    if (selectFavs.options.length == 0) {\n        selectFavs.addOptions({label: \"Favourite a coin to add it here!\", value: \"default\"});\n    }\n\n    return new ActionRowBuilder<StringSelectMenuBuilder>().addComponents(selectFavs);\n\n}\n\nexport function makeEmbed(choice: CryptoApiData, client: Client) {\n    return getEmbedTemplate(client)\n        .setThumbnail(`https://s2.coinmarketcap.com/static/img/coins/128x128/${choice.id}.png`)\n        .setColor(choice.percent_change_24h < 0 ? 0xed4245 : 0x3ba55c)\n        .setTitle(`${choice.name} (${choice.symbol}-USD)`)\n        .setURL(`https://coinmarketcap.com/currencies/${choice.slug}`)\n        .setFields({\n                name: \"Price\",\n                value: `$${choice.price < 1 ? scientificNotationToNumber(choice.price.toPrecision(4)) : Math.round(choice.price * 100) / 100} ${choice.percent_change_24h < 0 ? \"游댮\" : \"游릭\"}`\n            },\n            {\n                name: \"1h Change\",\n                value: `${Math.round(choice.percent_change_1h * 100) / 100}% ${choice.percent_change_1h < 0 ? \"游댮\" : \"游릭\"}`,\n                inline: true\n            },\n            {\n                name: \"24h Change\",\n                value: `${Math.round(choice.percent_change_24h * 100) / 100}% ${choice.percent_change_24h < 0 ? \"游댮\" : \"游릭\"}`,\n                inline: true\n            },\n            {\n                name: \"7d Change\",\n                value: `${Math.round(choice.percent_change_7d * 100) / 100}% ${choice.percent_change_7d < 0 ? \"游댮\" : \"游릭\"}`,\n                inline: true\n            },\n            {\n                name: \"24h Volume Change\",\n                value: `${Math.round(choice.volume_change_24h * 100) / 100}% ${choice.volume_change_24h < 0 ? \"游댮\" : \"游릭\"}`,\n                inline: true\n            },\n            {\n                name: \"Market Cap Dominance\",\n                value: `${Math.round(choice.market_cap_dominance * 100) / 100}%`,\n                inline: true\n            },\n            {name: \"Last Updated\", value: `<t:${new Date(choice.last_updated).getTime() / 1000}:R>`}\n        );\n}\n\nexport async function makeButtons(choice: CryptoApiData, interaction: BaseInteraction) {\n    const favourited = Object.values(await db.get(\"select exists(select 1 from user_settings where id=? and favouriteCrypto=?)\", interaction.user.id, choice.id))[0];\n    return new ActionRowBuilder<ButtonBuilder>()\n        .addComponents(\n            new ButtonBuilder()\n                .setCustomId(`coin_alerts_${interaction.user.id}`)\n                .setLabel(\"Add alert\")\n                .setEmoji(\"游댒\")\n                .setStyle(ButtonStyle.Primary)\n        )\n        .addComponents(\n            new ButtonBuilder()\n                .setCustomId(`coin_setfav_${interaction.user.id}`)\n                .setLabel(favourited ? \"Unfavourite\" : \"Favourite\")\n                .setEmoji(\"救\")\n                .setStyle(favourited ? ButtonStyle.Secondary : ButtonStyle.Primary)\n        )\n        .addComponents(\n            new ButtonBuilder()\n                .setCustomId(`coin_refresh_${interaction.user.id}`)\n                .setLabel(\"Refresh\")\n                .setEmoji(\"游댃\")\n                .setStyle(ButtonStyle.Primary)\n        );\n}\n"],"names":["ActionRowBuilder","ButtonBuilder","ButtonStyle","StringSelectMenuBuilder","db","UserSettingType","getEmbedTemplate","scientificNotationToNumber","makeFavouritesMenu","interaction","selectFavs","setCustomId","user","id","setPlaceholder","favs","all","FAVOURITE_CRYPTO","i","length","row","favName","get","favouriteCrypto","addOptions","label","name","value","toString","options","addComponents","makeEmbed","choice","client","setThumbnail","setColor","percent_change_24h","setTitle","symbol","setURL","slug","setFields","price","toPrecision","Math","round","percent_change_1h","inline","percent_change_7d","volume_change_24h","market_cap_dominance","Date","last_updated","getTime","makeButtons","favourited","Object","values","setLabel","setEmoji","setStyle","Primary","Secondary"],"mappings":"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"}